# 关系型数据库表设计

## 引言

常见的关系型数据库有 MySQL、Oracle，除了遵循[范式](./数据库表设计范式.md)外，还有一些其他的设计优化思路。

## 拆分策略

### 垂直分表拆分

把一张字段比较多的表拆分为多张表，有以下几个要点：

1. 将不常用的字段单独拆分到另外一张扩展表，减少查询带宽。
2. 将大文本的字段单独拆分到另外一张扩展表，比如 BLOB、TEXT、TINYBLOB、MEDIUMBLOB、LONGBLOB、TINYTEXT、MEDIUMTEXT、LONGTEXT 等类型。
3. 将不经常修改的字段放在同一张表中，将经常改变的字段放在另一张表中。比如用户表的设计中，存在“最后登录时间”字段，每次用户登录时会被更新。这张用户表会存在频繁的更新操作，而每次更新时会导致该表的查询缓存被清空。所以，可以把这个字段放到另一个表中，这样查询缓存会增加很多性能。
4. 对于需要经常关联查询的字段，建议放在同一张表中。不然在联合查询的情况下，会带来数据库额外压力。

### 水平分表拆分

把表的数据行进行拆分。因为表的行数超过几百万行时，就会变慢，这时可以把一张的表的数据拆成多张表来存放。水平拆分，有许多策略，例如，取模分表，时间维度分表，以及自定义 Hash 分表，例如用户 ID 维度分表等。

### 垂直分库拆分

按照业务和功能划分，把数据分别放到不同的数据库中。举个例子，可以划分资讯库、百科库等。

### 水平分库拆分

把一张表的数据划分到不同的数据库，两个数据库的表结构一样。

## 中间表策略

- 用来存储两个实体的关系。在多对多的关系中，可以通过建立中间表来存在两个实体的主键关联性（理论上一对一和一对多也可以这样关联），比如：

【作者表】（ID，姓名）

【书籍表】（ID，书名，类别）

【中间表】（作者 ID，书籍 ID）

- 用来存储中间计算结果。比如经常需要结合多张基本表进行查询数据，可以把查询的结果存储到中间表中，方便之后获取。当然有个前提是基本表的数据更新并不频繁，比如一天一更，那么可以设定一个定时器在每天凌晨把数据查询结果存储到中间表，之后直接从中间表获取。

**中间表和视图的使用场景区别：**

- 视图方案适用数据量比较小的场景
- 中间表适用数据量比较大的场景
