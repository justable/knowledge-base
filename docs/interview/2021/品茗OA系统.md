# 品茗 OA 系统

## 简历描述

项目描述：该项目是公司内部自行研发的 OA 系统，整个项目基于 umi+typescript+antd 开发。

我的任务：主要负责销售管理、客户管理、会议室预定、报销审批、OSS 存储等模块的研发与维护，同时也对一些业务组件进行分装，后来接入了 procomponents 来负责常见业务模型的开发，比如分页 table、提交表单。中后台项目会有大量和用户权限绑定的视图展示，借助 umi 的 access 插件能够很好的解决这问题。

结果：完成日常需求的迭代。期间也对 umi 体系做了思考，umi 对 React 应用的开发流程做了很多收敛和改造，在使用这类高阶框架享受便捷的同时，不能遗忘最本质的技术原理。

## 问答

- 对 umi 做了怎么样的思考

收敛 中间代码 提供特殊功能 UmiContext.Provider

- access 组件 权限控制

和路由配合，通过 hook 获取权限，Access 组件 fallback 特性，没使用 umi 之前，也会把 accesss 组件像这样分装`return <>{accessible ? children : fallback}</>`

- Concurrent 模式（必讲）
- 基于权限的部门员工组件
- @人，实时拍照生成头像 base64
- 一开始没用任何开源组件库基础组件都是公司内部写的，维护成本太大
- dva 背后是 saga，saga 基于 generator 函数，taker 注册信号（阻塞消耗型，fork），dispatch 触发信号，任务容器监听到信号就 next，当前注册信号被消耗，因此通常 while(true)

## 有哪些印象深刻的场景

- 登录

是基于 token 登录的，登录接口后端会生成一个 token，和用户信息一起作为键值对存放到 redis 中，并设置 expired 时间。之后将 token 返回前端，前端拿到后存到 cookie 中，之后的请求都在 request header 上携带该 token，后端会在每个登录态接口从 request header 中获取 token 并去 redis 获取用户信息，不存在则返回 401。

登录后会前端把当前用户信息存储到中央状态库中。

- 动态菜单

不同权限用户所见菜单和按钮不同。公司内部有个专门的资源配置中心，可以配置菜单、按钮等这些权限实体，后端基于 RBAC 权限模型查询并返回当前用户的可见菜单和按钮。

- 用户权限

登录后当前用户会有一个权限标识，配合`@umijs/plugin-access`实现基于权限控制的页面内容。

- 接入微前端

公司希望将内部各个前端项目进行模块拆分与合并，要拆分的是一些臃肿的项目，要合并的是零散部署在不同域名下的项目，最终实现统一域名访问，各模块独立开发和部署。

- OSS 文件存储

- 非即时评论@人

参照 MDN 的 Selection 和 Range API 开发，监听@键，contentedit，动态插入 span 包含用户 id 等信息，接口传输时利用正则将 span 标签替换成后端解析的格式。
