# 开放性题目

## 自我介绍

我 16 年毕业，大学主修的是 java，毕业后做了 1 年的后端，之后在工作中接触到了前端，自己感觉对前端更感兴趣就转前端了，平时除了前端 m 不过也没打算放弃后端，平时遇到些后端技术问题也会做点笔记，个人也租了个云服务学习应用部署方面的知识，比如个人云服务器上的服务都是同个 docker 管理的，然后现在找工作还是会找全职前端，不过平时也不会过滤其他技术，希望自己以后能往全栈方向发展。

## 组件如何封装

案例：

一个砸金蛋页面，页面的交互主体有金蛋，锤子，报幕，现在就谈谈这个报幕组件如何封装。

过程：

1. 清晰实现效果：每次锤子砸开金蛋，产生一条数据给报幕，然后报幕对数据源进行循环播报
2. 建立数据结构与视图之间的关系：数据源是中奖信息的列表，视图需要展示 8 条数据并自动播报，比如以滚动的方式，那么就可以利用滑动窗口从数据源获取下次要展示的数据
3. 思考哪些节点可以暴露给使用者自定义：比如视图一次所展示的数据条数，滚动间隔，滚动速度，是否自动滚动，每条数据的自定义渲染函数，进一步的是否可以把动画类型也定制化，比如支持滚动或 fade 渐隐，然后在动画容器节点配置不同的动画 class，最后写好 props 的 TS 接口
4. 实现阶段：注意边界情况，比如数据源总条数是否小于视图所展示的条数，数据替换时机得在动画结束后替换用户才不会感知到
5. 单元测试：检验这个组件是否对单元测试友好，是否容易被单测也是一个组件逻辑是否恰当的判断依据，继而进一步完善代码实现，主要测输入源是否渲染预期结构

## 遇到过最棘手的问题如何解决的

那就谈谈如何修 bug 吧，首先会根据 error stack 的信息来定位，如果 error message 表达了很清楚的意思，比如我在写 ssr 的时候报了 document is not defined，那肯定就是在 node 环境使用到了浏览器专属的变量，我一般会全局搜索关键字或者有针对性的去 node 环境会执行到的代码区域查找问题（比如使用 isBrowser 判断或放到 useEffect 中）；如果 error message 是一些通用的异常术语无法直观体现错误原因的，我一般会根据代码错误行列信息去源码查看，即使源码被压缩过也能获得一些信息。

所以可以总结为缩小区域，根据 error stack 和常规逻辑进行定位

## 最有挑战性的

商城重构

1. 调整心态，刚接到这个任务时我是抗拒的，感觉是个坑，原参与者大多都离职了，需求文档不完善，经过一段自我心理调节，我也认为抗拒不解决根本问题，尽自己最大努力去做，中途有困难及时与同事沟通寻找解决方案
2. 需求的梳理，我主要通过在测试环境边跑流程边看代码，按照主线流程进行梳理帮助自己理解原有业务和代码（偏页面需求梳理，比如某个表单提交的逻辑，哪些入口访问需要登录态，为此我封装了一个 auth-route，未登录就当前页面弹登录框并把用户信息存到 redux 中）
3. 实际开发，使用自己擅长的 react 和 ts，持续了 2 个月，然后做性能优化，比如资源动态导入，资源 cdn，使用 IntersectionObserver 图片 data-src 等等，之后也把构建迁移到了 umi 上

```js
const io = new IntersectionObserver(() => {
  // 实例化 默认基于当前视窗
});

let imgs = document.querySelectorAll('[data-src]'); // 将图片的真实url设置为data-src src属性为占位图 元素可见时候替换src

function callback(entries) {
  entries.forEach(item => {
    // 遍历entries数组
    if (item.isIntersecting) {
      // 当前元素可见
      item.target.src = item.target.dataset.src; // 替换src
      io.unobserve(item.target); // 停止观察当前元素 避免不可见时候再次调用callback函数
    }
  });
}

imgs.forEach(item => {
  // io.observe接受一个DOM元素，添加多个监听 使用forEach
  io.observe(item);
});
```

4. 做总结

交流 先要确保双方的观点都被对方接收到 之后的交流才有意义嘛 不能你云我云 提高效率
重构 梳理几条流程线
