# CDN 介绍

> 全称 Content Delivery Network，即内容分发网络

## 概述

CDN 其实是建立在真实网络之上，由分布在不同区域的边缘节点（缓存）服务器群组成的分布式网络。

其本质是在用户与源站间建立缓存层，主要有如下功能：

1. 减少对源站服务器的访问次数
1. 负载均衡，根据用户地域，节点负荷等合理分配节点服务器，加速反应时间
1. 集群抗攻击，广泛分布的 CDN 节点加上节点之间的智能冗余机制，可以有效地预防黑客入侵以及降低各种 D.D.o.S 攻击对网站的影响，同时保证较好的服务质量

## 具体架构

![image.png](https://cdn.nlark.com/yuque/0/2020/png/467908/1609227021543-4fb26ab1-118c-4ed4-98ad-1f65dc0511fc.png#align=left&display=inline&height=439&margin=%5Bobject%20Object%5D&name=image.png&originHeight=548&originWidth=893&size=256035&status=done&style=none&width=715)

### 特点

1. CDN 是和域名绑定的，只有配置开启了 CDN 加速的域名才会进入 CDN 节点群
1. CDN 节点中的缓存如果没有命中，就会请求下一层缓存组（如果配置了多层缓存）或回溯请求源站并更新自身缓存

### 技术点

- 内容发布：它借助于建立索引、缓存、流分裂、组播（Multicast）等技术；
- 内容路由：它是整体性的网络负载均衡技术，通过内容路由器中的重定向（DNS）机制，在多个远程 POP 上均衡用户的请求，以使用户请求得到最近内容源的响应；
- 内容交换：它根据内容的可用性、服务器的可用性以及用户的背景，在 POP 的缓存服务器上，利用应用层交换、流分裂、重定向（ICP、WCCP）等技术，智能地平衡负载流量；
- 性能管理：它通过内部和外部监控系统，获取网络部件的状况信息，测量内容发布的端到端性能（如包丢失、延时、平均带宽、启动时间、帧速率等），保证网络处于最佳的运行状态。

## Q&A

### CDN 和镜像站点的区别

CDN 对网站的访客完全透明，不需要访客手动选择要访问的镜像站点，部署更简单，对原站基本不做任何改动即可生效。

### 如何手动更新 CDN 节点的缓存

通常 CDN 管理面板中会提供 URL 推送服务，来通知 CDN 各节点刷新自己的缓存。在 URL 推送地址栏中，输入具体的网址或者图片地址，则各节点中的缓存内容即被统一删除，并且当即生效。

### 如何让网站的一部分资源 CDN 加速另一部分不加速

采用一个网站两个域名，一个启用 CDN，另外一个域名不用 CDN，对即时性要求高的页面和图片放在不用 CDN 的域名下。

### 频繁更新的资源导致缓存失效

比如淘宝的商品图会在节日前大批量的更换，此时会导致所有 CDN 上的缓存失效，对源站造成巨大冲击，还会导致所有图片链接失效。解决办法：

1. 改图保持图片 URL 不变，可以避免商品链路的缓存失效。
1. 在访问高峰到来之前，提前预热图片到 CDN，可以避免 CDN 缓存失效对源站的压力。

## References

[https://www.zhihu.com/question/37353035/answer/175217812](https://www.zhihu.com/question/37353035/answer/175217812)
[https://www.zhihu.com/question/36514327/answer/1604554133](https://www.zhihu.com/question/36514327/answer/1604554133)
